;(function(){
    const menuChoise = document.querySelector('#horizontalChoise');
    const itemsChoise = document.querySelectorAll('.choise__item');
    
    const getItemsWidth = (item) => {
        let resultWidth = 400;
        const windowWidth = window.innerWidth;
        const itemWidth = item.offsetWidth;
        const isTablet = window.matchMedia("(max-width: 768px)").matches;
        const isPhone = window.matchMedia("(max-width: 480px)").matches;
    
        if (isTablet){
            resultWidth = windowWidth - itemWidth * itemsChoise.length;
        }
        if (isPhone){
            resultWidth = windowWidth - itemWidth;
        }
        // console.log('getItemsWidth');
        return resultWidth;
    };
    
    const setItemWidth = (item, width) => {
        const itemContent = item.nextElementSibling;
        const itemText = item.firstElementChild;
        itemContent.style.width = `${width}px`;
        itemText.style.width = `${width}px`;
    };
    
    const Item1 = document.getElementsByClassName('choise__item');
    
    for (let i = 0; i < Item1.length; i++) {
        const element = Item1[i];
    
        element.addEventListener('click', function(e){
            for (let index = 0; index < Item1.length; index++) {
                if (index !== i){
                    Item1[index].classList.remove('choise__content--active');
                }            
            }
    
            if (element.classList.contains('choise__content--active')){
                element.classList.remove('choise__content--active');
            } else {
                element.classList.add('choise__content--active');
            };
        });
    };
})();;(function(){
    const hamburger = document.querySelector(".hamburger");
    const menu = document.querySelector('.menu');
    const lock = document.querySelector('body');
    
    hamburger.addEventListener('click', e => {
        if (hamburger.classList.contains('hamburger--active') && menu.classList.contains('menu--active') && lock.classList.contains('lock')) {
            hamburger.classList.remove('hamburger--active');
            menu.classList.remove('menu--active');
            lock.classList.remove('lock');
            console.log('close бургер =|');
    
        } else {
            hamburger.classList.add('hamburger--active');
            menu.classList.add('menu--active');
            lock.classList.add('lock');
            console.log('open бургер =)');
        }
    })
    
    menu.addEventListener('click', e => {
        e.preventDefault();
        hamburger.classList.remove('hamburger--active');
        menu.classList.remove('menu--active');
        lock.classList.remove('lock');
        console.log('close бургер =|');
    })    
})()

;;(function(){
  let myMap;

  const init = () => {
    myMap = new ymaps.Map("map", {
      center: [56.004796, 92.865292],
      zoom: 12,
      controls: [],
    });
  
    let coords = [
      [55.986798, 92.854737],
      [55.994446, 92.797586],
      [55.918994, 92.740482],
      [55.968648, 92.374352],
    ],
      myCollection = new ymaps.GeoObjectCollection({}, {
        draggable: false,
        iconLayout: 'default#image',
        iconImageHref: './image/icons/marker.svg',
        iconImageSize: [46, 57],
        iconImageOffset: [-35, -52]
      });
  
    for (let i = 0; i < coords.length; i++) {
      myCollection.add(new ymaps.Placemark(coords[i]));
    }
  
    myMap.geoObjects.add(myCollection);
  
    myMap.behaviors.disable('scrollZoom');
    myMap.controls.add('zoomControl', {
      size: "large"
    });
  };
  
  ymaps.ready(init);
})()

;;(function(){
    const validateFields = (form, fieldArray) =>{
        fieldArray.forEach((field) => {
            field.removeClass("form__input--error");
            if (field.val().trim() === "") {
                field.addClass("form__input--error");
            }
        });
    
        const errorField = form.find(".form__input--error");
    
        return errorField.length === 0;
    }
    
    $('.form').submit( e => {
        e.preventDefault();
    
        
        const form = $(e.currentTarget);
        const name = form.find("[name='name']");
        const phone = form.find("[name='phone']");
        const comment = form.find("[name='comment']");
        const to = form.find("[name='to']");
    
        const modal =$("#modal");
        const content = modal.find(".modal__content");
    
        const isValid = validateFields(form, [name, phone, comment, to]);
    
        if (isValid){
           const request = $.ajax({
                url: "https://webdev-api.loftschool.com/sendmail",
                method: "post",
        
                data: {
                    name: name.val(),
                    phone: phone.val(),
                    comment: comment.val(),
                    to: to.val()
                },
    
                // success: data =>{
                    
                // },
    
                // error: data =>{
                    
                // }
            }); 
    
            request.done(data =>{
                console.log(data);
                    content.text(data.message)
                    
                $.fancybox.open({
                    src: "#modal",
                    type: "inline"
                });
            });
    
            request.fail(data=>{
                const message = data.responseJSON.message;
                content.text(message);
                console.log(data);
    
                $.fancybox.open({
                    src: "#modal",
                    type: "inline"
                });
            });
            
            // request.always(()=>{
            //     $.fancybox.open({
            //         src: "#modal",
            //         type: "inline"
            //     }); 
            // })
        }
    
        // $.ajax({
        //     url: "https://webdev-api.loftschool.com/sendmail",
        //     method: "post",
    
        //     data: {
        //         name: name.val(),
        //         phone: phone.val(),
        //         comment: phone.val(),
        //         to: to.val()
        //     }
        // }); 
    
        // $.fancybox.open({
        //     src: "#modal",
        //     type: "inline"
        // });
    });
    
    
    
    $('.app-modal-close').click(e =>{
        e.preventDefault();
    
        $.fancybox.close();
    });
})()

;const sections = $('section');
const display = $('.maincontent');
const sideMenu = $('.fixed-menu');
const menuItems = sideMenu.find('.fixed-menu__item');

const mobileDetect = new MobileDetect(window.navigator.userAgent);
const isMobile = mobileDetect.mobile();

let inScroll = false;

sections.first().addClass('active');

const counSectionPosition = sectionEq => {
    const position = sectionEq * -100;

    if (isNaN(position)){
        console.error("передано не верное значение в counSectionPosition");
        return 0;
    };

    return position;
};

const resetActiveClassForItem = (items, itemEq, activeClass) => {
    items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
};

const performTransition = sectionEq => {
    if (inScroll) return
    const transitionOver = 1000;
    const mouseInertiaOver = 300;

    inScroll = true;

    const position = counSectionPosition(sectionEq);

    display.css({
        transform: `translateY(${position}%)`,
    });

    resetActiveClassForItem(sections, sectionEq, 'active');

    setTimeout(() =>{
        inScroll= false;

        resetActiveClassForItem(menuItems, sectionEq, 'fixed-menu__item--active'); 
    }, transitionOver + mouseInertiaOver);
    
};

const vieportScroller = () => {
const activeSection = sections.filter(".active");
const nextSection = activeSection.next();
const prevSection = activeSection.prev();

    return {
        next (){
            if (nextSection.length) {
                performTransition(nextSection.index());
            }
        },

        prev(){
            if (prevSection.length) {
                performTransition(prevSection.index());
            }
        }
    }    
}

$(window).on('wheel', e =>{
    const deltaY = e.originalEvent.deltaY;
    const scroller = vieportScroller();

    if (deltaY > 0){
        scroller.next();
        // scrollVieport('next');
    }
    if (deltaY < 0){
        scroller.prev();
        // scrollVieport('prev');
    }
    console.log(deltaY);
});

$(window).on("keydown", (e)=>{
    const tagName = e.target.tagName.toLowerCase();
    const userTypingInputs = tagName == "input" || tagName == "textarea";
    const scroller = vieportScroller();
    
    if (userTypingInputs) return;
    
    switch(e.keyCode){
        case 38:
            scroller.prev();;
            break;
        case 40:
            scroller.next();;
            break;
    };
});

$("[data-scroll-to]").click(e =>{
    e.preventDefault();

    const $this = $(e.currentTarget);
    const target = $this.attr('data-scroll-to');
    const reqSection = $(`[data-section-id=${[target]}]`);

    performTransition(reqSection.index());
});

if (isMobile){
    //https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
    $("body").swipe ({
        swipe: function(event, direction) {
            const scroller = vieportScroller();
            let scrollDirection = "";

            if (direction === "up") scrollDirection = "next";
            if (direction === "down") scrollDirection = "prev";
            
            if (scrollDirection) {
                scroller[scrollDirection]();
            }
        }
    });   
}

;;(function(){
// большая кнопка воспроизведения
const playBtn = document.querySelector(".video__player-img");
// маленькая кнопка восроизведения
const playerPlayBrn = document.querySelector(".duration__img");
// само видео
const video = document.getElementById("player");
// input с помощью которого выставляется время воспроизведения
const durationControl = document.getElementById("durationLevel");
// input с помощью которого выставляется громкость
const soundControl = document.getElementById("micLevel");
// обёртка управления громкостью
const soundBtn = document.getElementById("soundBtn");
// кнопка с динамиком, с помощью которой мы будем включить или выключать громкость 
const dynamicBtn = document.getElementById('dynamic');
// идентификатор интервала, который будет отрисовывать текущее время воспроизведения
let intervalId;
// переменная для сохранения уровня громкости перед выключением звука
let soundLevel;

// отслеживаем загрузку медифайлов страницы
window.addEventListener('load', function() {
  // при клике на само видео выполняем функцию playStop
  video.addEventListener("click", playStop);
   // находим все кнопки управления play/pause
  let playButtons = document.querySelectorAll(".play");
  
  for (let i = 0; i < playButtons.length; i++) {
    // при клике на эти кнопки выполняем функцию playStop
    playButtons[i].addEventListener("click", playStop);
  }

  // выставляем минимальное значение ползунка времени воспроизведения
  durationControl.min = 0;
  // выставляем время воспроизведения в ноль
  durationControl.value = 0;
  // выставляем максимальное значение ползунка времени воспроизведения по длительности видео
  durationControl.max = video.duration;
  // при кликах или перетягивании ползунка выполняем функцию setVideoDuration
  durationControl.addEventListener("input", setVideoDuration);

  // выставляем минимальное значение ползунка громкости
  soundControl.min = 0;
  // выставляем максимальное значение ползунка громкости
  soundControl.max = 10;
  // выставляем текущее положение ползунка громкости на максимум
  soundControl.value = soundControl.min;
  // при кликах или перетягивании ползунка выполняем функцию changeSoundVolume
  soundControl.addEventListener("input", changeSoundVolume);

  // при клике на динамик выполняем soundOf
  dynamicBtn.addEventListener('click', soundOf);

  // когда видео закончится
  video.addEventListener('ended', () => {
      // выставляем классы на кнопки, чтоб отобразить, что можно воспроизводить снова
      playBtn.classList.toggle('video__player-img--active');
      playerPlayBrn.classList.remove('active');
      // устанавливаем время воспроизведения в ноль
      video.currentTime = 0;
  })
});

// функция воспроизводить/поставить на паузу
function playStop() {
  // устанавливаем активные классы на элементы чтоб показать воспроизводится сейчас видео или нет
  playBtn.classList.toggle("video__player-img--active");
  playerPlayBrn.classList.toggle("active");

  // если видео на паузе
  if (video.paused) {
    // запускаем его
    video.play();
    // запускаем отрисовку ползунка времени воспроизведения
    intervalId = setInterval(updateDuration, 1000 / 60);
  // если видео не на паузе
  } else {
    // останавливаем отрисовку ползунка времени воспроизведения
    clearInterval(intervalId);
    // ставим видео на паузу
    video.pause();
  }
}

// функция установить текущее время воспроизведения
function setVideoDuration() {
  // установливает текущее время воспроизведения видео по позиции ползунка
  video.currentTime = durationControl.value;
  // отрисовывает полосу прогресса
  updateDuration();
}

/*
  Функция для обновления позиции ползунка продолжительности видео.   
*/
function updateDuration() {
  // устанавливаем в наш инпут текущее время
  durationControl.value = video.currentTime;
  // рассчитываем процент для закраски прогресса
  let step = video.duration / 100; // 121 / 100 = 1.21
  let percent = video.currentTime / step; // 60 / 1.21
  // устанавливаем стили
  durationControl.style.background = `linear-gradient(90deg, #FEDB3F 0%, #FEDB3F ${percent}%, #626262 ${percent}%)`;
}

// функция изменения уровня громкости
function changeSoundVolume() {
  // видео принимает только значения от 0 до 1, то есть дробные числа
  // поэтому текущее значение ползунка громкости делим на 10
  video.volume = soundControl.value / 10; // 0.1 0.8...
  // если мы выставили ползунок в ноль
  if (video.volume === 0) {
    // то отображаем на динамике что звук выключен
    soundBtn.classList.add("active");
  // если звук не выключен, то снимаем отображение выключенного звука с икноки динамика
  } else {
    soundBtn.classList.remove("active");
  }
}

// функция включения/выключения звука
function soundOf() {
  // если при запуске функции звук выключен
  if (video.volume === 0) {
      // мы берем предыдущее сохраненное значение громкости и выставляем в видео
      video.volume = soundLevel;
      // отрисовываем это в ползунок громкости
      soundControl.value = soundLevel * 10;
      // убираем отображение выключенного звука с иконки динамика
      soundBtn.classList.remove('active');
  // если при запуске функции звук включен
  } else {
    // сохраняем текущее значение громкости
    soundLevel = video.volume;
    // выставляем громкость в ноль
    video.volume = 0;
    // отрисовываем это на ползунке громкости
    soundControl.value = 0;
    // отображаем на иконке динамика, что звук выключен
    soundBtn.classList.add('active');
  }
}
})();;(function(){
    const itemRecall = document.querySelectorAll('.reviews__item');
    const itemUser = document.querySelectorAll('.reviews-users__item');
    
    itemUser.forEach(function (item) {
        item.addEventListener('click', function(){
            let currentBtn = item;
            let currentId = currentBtn.getAttribute("data-open");
            let currentTab = document.querySelector(currentId);
    
            if(!currentBtn.classList.contains('interactive__avatar--active')) {
                itemUser.forEach(function(item){
                    item.classList.remove('interactive__avatar--active')
                });
        
                itemRecall.forEach(function(item){
                    item.classList.remove('reviews__item--showing');
                });
        
                currentBtn.classList.add('interactive__avatar--active');
                currentTab.classList.add('reviews__item--showing');
            } 
        });
    });
})();;(function(){
    const sliderShop = $('.shop__list').bxSlider({
        pager: false,
        controls: false
    });
    
    $('.slider__shop-left').click((e) =>{
        e.preventDefault();
    
        sliderShop.goToPrevSlide();
    })
    $('.slider__shop-right').click((e)=>{
        e.preventDefault();
    
        sliderShop.goToNextSlide();
    })
})();;(function(){
    const teamName = document.querySelectorAll('.team__name');
    const teamDesc = document.querySelectorAll('.team__desc');
    
    function closeEveryItems(){
        for (let i = 0; i < teamName.length; i++) {
            const button = teamName[i];
    
            const desc = button.nextElementSibling;
            desc.classList.remove('team__desc--active');
            button.classList.remove('team__name--active');        
        }
    }
    
    for (let index = 0; index < teamName.length; index++) {
        const button = teamName[index];
        button.addEventListener('click', function(event) {   
    
            if (teamName[index].classList.contains('team__name--active') && teamDesc[index].classList.contains('team__desc--active')) {
                closeEveryItems()
            } else {
                closeEveryItems()
                teamDesc[index].classList.add('team__desc--active');
                teamName[index].classList.add('team__name--active');
            }
        });
    }
})()

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNob2lzZS5qcyIsImhhbWJlcmdlci5qcyIsIm1hcC5qcyIsIm1vZGFsLmpzIiwib3BzLmpzIiwicGxheWVyLmpzIiwicmV2aWV3cy5qcyIsInNob3AuanMiLCJ0ZWFtLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQy9DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0M3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0N2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ2pJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtDOUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0NoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIjsoZnVuY3Rpb24oKXtcclxuICAgIGNvbnN0IG1lbnVDaG9pc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaG9yaXpvbnRhbENob2lzZScpO1xyXG4gICAgY29uc3QgaXRlbXNDaG9pc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2hvaXNlX19pdGVtJyk7XHJcbiAgICBcclxuICAgIGNvbnN0IGdldEl0ZW1zV2lkdGggPSAoaXRlbSkgPT4ge1xyXG4gICAgICAgIGxldCByZXN1bHRXaWR0aCA9IDQwMDtcclxuICAgICAgICBjb25zdCB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgICAgIGNvbnN0IGl0ZW1XaWR0aCA9IGl0ZW0ub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgY29uc3QgaXNUYWJsZXQgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDc2OHB4KVwiKS5tYXRjaGVzO1xyXG4gICAgICAgIGNvbnN0IGlzUGhvbmUgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDQ4MHB4KVwiKS5tYXRjaGVzO1xyXG4gICAgXHJcbiAgICAgICAgaWYgKGlzVGFibGV0KXtcclxuICAgICAgICAgICAgcmVzdWx0V2lkdGggPSB3aW5kb3dXaWR0aCAtIGl0ZW1XaWR0aCAqIGl0ZW1zQ2hvaXNlLmxlbmd0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzUGhvbmUpe1xyXG4gICAgICAgICAgICByZXN1bHRXaWR0aCA9IHdpbmRvd1dpZHRoIC0gaXRlbVdpZHRoO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBjb25zb2xlLmxvZygnZ2V0SXRlbXNXaWR0aCcpO1xyXG4gICAgICAgIHJldHVybiByZXN1bHRXaWR0aDtcclxuICAgIH07XHJcbiAgICBcclxuICAgIGNvbnN0IHNldEl0ZW1XaWR0aCA9IChpdGVtLCB3aWR0aCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGl0ZW1Db250ZW50ID0gaXRlbS5uZXh0RWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgY29uc3QgaXRlbVRleHQgPSBpdGVtLmZpcnN0RWxlbWVudENoaWxkO1xyXG4gICAgICAgIGl0ZW1Db250ZW50LnN0eWxlLndpZHRoID0gYCR7d2lkdGh9cHhgO1xyXG4gICAgICAgIGl0ZW1UZXh0LnN0eWxlLndpZHRoID0gYCR7d2lkdGh9cHhgO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgY29uc3QgSXRlbTEgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjaG9pc2VfX2l0ZW0nKTtcclxuICAgIFxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBJdGVtMS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBJdGVtMVtpXTtcclxuICAgIFxyXG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IEl0ZW0xLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSBpKXtcclxuICAgICAgICAgICAgICAgICAgICBJdGVtMVtpbmRleF0uY2xhc3NMaXN0LnJlbW92ZSgnY2hvaXNlX19jb250ZW50LS1hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgIH0gICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnY2hvaXNlX19jb250ZW50LS1hY3RpdmUnKSl7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2Nob2lzZV9fY29udGVudC0tYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Nob2lzZV9fY29udGVudC0tYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG59KSgpIiwiOyhmdW5jdGlvbigpe1xyXG4gICAgY29uc3QgaGFtYnVyZ2VyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5oYW1idXJnZXJcIik7XHJcbiAgICBjb25zdCBtZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1lbnUnKTtcclxuICAgIGNvbnN0IGxvY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XHJcbiAgICBcclxuICAgIGhhbWJ1cmdlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG4gICAgICAgIGlmIChoYW1idXJnZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdoYW1idXJnZXItLWFjdGl2ZScpICYmIG1lbnUuY2xhc3NMaXN0LmNvbnRhaW5zKCdtZW51LS1hY3RpdmUnKSAmJiBsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9jaycpKSB7XHJcbiAgICAgICAgICAgIGhhbWJ1cmdlci5jbGFzc0xpc3QucmVtb3ZlKCdoYW1idXJnZXItLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICBtZW51LmNsYXNzTGlzdC5yZW1vdmUoJ21lbnUtLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICBsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvY2snKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2Nsb3NlINCx0YPRgNCz0LXRgCA9fCcpO1xyXG4gICAgXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaGFtYnVyZ2VyLmNsYXNzTGlzdC5hZGQoJ2hhbWJ1cmdlci0tYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIG1lbnUuY2xhc3NMaXN0LmFkZCgnbWVudS0tYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIGxvY2suY2xhc3NMaXN0LmFkZCgnbG9jaycpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnb3BlbiDQsdGD0YDQs9C10YAgPSknKTtcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgXHJcbiAgICBtZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGhhbWJ1cmdlci5jbGFzc0xpc3QucmVtb3ZlKCdoYW1idXJnZXItLWFjdGl2ZScpO1xyXG4gICAgICAgIG1lbnUuY2xhc3NMaXN0LnJlbW92ZSgnbWVudS0tYWN0aXZlJyk7XHJcbiAgICAgICAgbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdsb2NrJyk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2Nsb3NlINCx0YPRgNCz0LXRgCA9fCcpO1xyXG4gICAgfSkgICAgXHJcbn0pKClcclxuXHJcbiIsIjsoZnVuY3Rpb24oKXtcclxuICBsZXQgbXlNYXA7XHJcblxyXG4gIGNvbnN0IGluaXQgPSAoKSA9PiB7XHJcbiAgICBteU1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xyXG4gICAgICBjZW50ZXI6IFs1Ni4wMDQ3OTYsIDkyLjg2NTI5Ml0sXHJcbiAgICAgIHpvb206IDEyLFxyXG4gICAgICBjb250cm9sczogW10sXHJcbiAgICB9KTtcclxuICBcclxuICAgIGxldCBjb29yZHMgPSBbXHJcbiAgICAgIFs1NS45ODY3OTgsIDkyLjg1NDczN10sXHJcbiAgICAgIFs1NS45OTQ0NDYsIDkyLjc5NzU4Nl0sXHJcbiAgICAgIFs1NS45MTg5OTQsIDkyLjc0MDQ4Ml0sXHJcbiAgICAgIFs1NS45Njg2NDgsIDkyLjM3NDM1Ml0sXHJcbiAgICBdLFxyXG4gICAgICBteUNvbGxlY3Rpb24gPSBuZXcgeW1hcHMuR2VvT2JqZWN0Q29sbGVjdGlvbih7fSwge1xyXG4gICAgICAgIGRyYWdnYWJsZTogZmFsc2UsXHJcbiAgICAgICAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxyXG4gICAgICAgIGljb25JbWFnZUhyZWY6ICcuL2ltYWdlL2ljb25zL21hcmtlci5zdmcnLFxyXG4gICAgICAgIGljb25JbWFnZVNpemU6IFs0NiwgNTddLFxyXG4gICAgICAgIGljb25JbWFnZU9mZnNldDogWy0zNSwgLTUyXVxyXG4gICAgICB9KTtcclxuICBcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29vcmRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIG15Q29sbGVjdGlvbi5hZGQobmV3IHltYXBzLlBsYWNlbWFyayhjb29yZHNbaV0pKTtcclxuICAgIH1cclxuICBcclxuICAgIG15TWFwLmdlb09iamVjdHMuYWRkKG15Q29sbGVjdGlvbik7XHJcbiAgXHJcbiAgICBteU1hcC5iZWhhdmlvcnMuZGlzYWJsZSgnc2Nyb2xsWm9vbScpO1xyXG4gICAgbXlNYXAuY29udHJvbHMuYWRkKCd6b29tQ29udHJvbCcsIHtcclxuICAgICAgc2l6ZTogXCJsYXJnZVwiXHJcbiAgICB9KTtcclxuICB9O1xyXG4gIFxyXG4gIHltYXBzLnJlYWR5KGluaXQpO1xyXG59KSgpXHJcblxyXG4iLCI7KGZ1bmN0aW9uKCl7XHJcbiAgICBjb25zdCB2YWxpZGF0ZUZpZWxkcyA9IChmb3JtLCBmaWVsZEFycmF5KSA9PntcclxuICAgICAgICBmaWVsZEFycmF5LmZvckVhY2goKGZpZWxkKSA9PiB7XHJcbiAgICAgICAgICAgIGZpZWxkLnJlbW92ZUNsYXNzKFwiZm9ybV9faW5wdXQtLWVycm9yXCIpO1xyXG4gICAgICAgICAgICBpZiAoZmllbGQudmFsKCkudHJpbSgpID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBmaWVsZC5hZGRDbGFzcyhcImZvcm1fX2lucHV0LS1lcnJvclwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgY29uc3QgZXJyb3JGaWVsZCA9IGZvcm0uZmluZChcIi5mb3JtX19pbnB1dC0tZXJyb3JcIik7XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gZXJyb3JGaWVsZC5sZW5ndGggPT09IDA7XHJcbiAgICB9XHJcbiAgICBcclxuICAgICQoJy5mb3JtJykuc3VibWl0KCBlID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBmb3JtID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgICAgIGNvbnN0IG5hbWUgPSBmb3JtLmZpbmQoXCJbbmFtZT0nbmFtZSddXCIpO1xyXG4gICAgICAgIGNvbnN0IHBob25lID0gZm9ybS5maW5kKFwiW25hbWU9J3Bob25lJ11cIik7XHJcbiAgICAgICAgY29uc3QgY29tbWVudCA9IGZvcm0uZmluZChcIltuYW1lPSdjb21tZW50J11cIik7XHJcbiAgICAgICAgY29uc3QgdG8gPSBmb3JtLmZpbmQoXCJbbmFtZT0ndG8nXVwiKTtcclxuICAgIFxyXG4gICAgICAgIGNvbnN0IG1vZGFsID0kKFwiI21vZGFsXCIpO1xyXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBtb2RhbC5maW5kKFwiLm1vZGFsX19jb250ZW50XCIpO1xyXG4gICAgXHJcbiAgICAgICAgY29uc3QgaXNWYWxpZCA9IHZhbGlkYXRlRmllbGRzKGZvcm0sIFtuYW1lLCBwaG9uZSwgY29tbWVudCwgdG9dKTtcclxuICAgIFxyXG4gICAgICAgIGlmIChpc1ZhbGlkKXtcclxuICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gJC5hamF4KHtcclxuICAgICAgICAgICAgICAgIHVybDogXCJodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWxcIixcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZS52YWwoKSxcclxuICAgICAgICAgICAgICAgICAgICBwaG9uZTogcGhvbmUudmFsKCksXHJcbiAgICAgICAgICAgICAgICAgICAgY29tbWVudDogY29tbWVudC52YWwoKSxcclxuICAgICAgICAgICAgICAgICAgICB0bzogdG8udmFsKClcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3M6IGRhdGEgPT57XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBlcnJvcjogZGF0YSA9PntcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgfSk7IFxyXG4gICAgXHJcbiAgICAgICAgICAgIHJlcXVlc3QuZG9uZShkYXRhID0+e1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGVudC50ZXh0KGRhdGEubWVzc2FnZSlcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgc3JjOiBcIiNtb2RhbFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaW5saW5lXCJcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICByZXF1ZXN0LmZhaWwoZGF0YT0+e1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGRhdGEucmVzcG9uc2VKU09OLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICBjb250ZW50LnRleHQobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgJC5mYW5jeWJveC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICBzcmM6IFwiI21vZGFsXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpbmxpbmVcIlxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gcmVxdWVzdC5hbHdheXMoKCk9PntcclxuICAgICAgICAgICAgLy8gICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgc3JjOiBcIiNtb2RhbFwiLFxyXG4gICAgICAgICAgICAvLyAgICAgICAgIHR5cGU6IFwiaW5saW5lXCJcclxuICAgICAgICAgICAgLy8gICAgIH0pOyBcclxuICAgICAgICAgICAgLy8gfSlcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAvLyAkLmFqYXgoe1xyXG4gICAgICAgIC8vICAgICB1cmw6IFwiaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsXCIsXHJcbiAgICAgICAgLy8gICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICBcclxuICAgICAgICAvLyAgICAgZGF0YToge1xyXG4gICAgICAgIC8vICAgICAgICAgbmFtZTogbmFtZS52YWwoKSxcclxuICAgICAgICAvLyAgICAgICAgIHBob25lOiBwaG9uZS52YWwoKSxcclxuICAgICAgICAvLyAgICAgICAgIGNvbW1lbnQ6IHBob25lLnZhbCgpLFxyXG4gICAgICAgIC8vICAgICAgICAgdG86IHRvLnZhbCgpXHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyB9KTsgXHJcbiAgICBcclxuICAgICAgICAvLyAkLmZhbmN5Ym94Lm9wZW4oe1xyXG4gICAgICAgIC8vICAgICBzcmM6IFwiI21vZGFsXCIsXHJcbiAgICAgICAgLy8gICAgIHR5cGU6IFwiaW5saW5lXCJcclxuICAgICAgICAvLyB9KTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBcclxuICAgIFxyXG4gICAgJCgnLmFwcC1tb2RhbC1jbG9zZScpLmNsaWNrKGUgPT57XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgXHJcbiAgICAgICAgJC5mYW5jeWJveC5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbn0pKClcclxuXHJcbiIsImNvbnN0IHNlY3Rpb25zID0gJCgnc2VjdGlvbicpO1xyXG5jb25zdCBkaXNwbGF5ID0gJCgnLm1haW5jb250ZW50Jyk7XHJcbmNvbnN0IHNpZGVNZW51ID0gJCgnLmZpeGVkLW1lbnUnKTtcclxuY29uc3QgbWVudUl0ZW1zID0gc2lkZU1lbnUuZmluZCgnLmZpeGVkLW1lbnVfX2l0ZW0nKTtcclxuXHJcbmNvbnN0IG1vYmlsZURldGVjdCA9IG5ldyBNb2JpbGVEZXRlY3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xyXG5jb25zdCBpc01vYmlsZSA9IG1vYmlsZURldGVjdC5tb2JpbGUoKTtcclxuXHJcbmxldCBpblNjcm9sbCA9IGZhbHNlO1xyXG5cclxuc2VjdGlvbnMuZmlyc3QoKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcblxyXG5jb25zdCBjb3VuU2VjdGlvblBvc2l0aW9uID0gc2VjdGlvbkVxID0+IHtcclxuICAgIGNvbnN0IHBvc2l0aW9uID0gc2VjdGlvbkVxICogLTEwMDtcclxuXHJcbiAgICBpZiAoaXNOYU4ocG9zaXRpb24pKXtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwi0L/QtdGA0LXQtNCw0L3QviDQvdC1INCy0LXRgNC90L7QtSDQt9C90LDRh9C10L3QuNC1INCyIGNvdW5TZWN0aW9uUG9zaXRpb25cIik7XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBwb3NpdGlvbjtcclxufTtcclxuXHJcbmNvbnN0IHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtID0gKGl0ZW1zLCBpdGVtRXEsIGFjdGl2ZUNsYXNzKSA9PiB7XHJcbiAgICBpdGVtcy5lcShpdGVtRXEpLmFkZENsYXNzKGFjdGl2ZUNsYXNzKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKGFjdGl2ZUNsYXNzKTtcclxufTtcclxuXHJcbmNvbnN0IHBlcmZvcm1UcmFuc2l0aW9uID0gc2VjdGlvbkVxID0+IHtcclxuICAgIGlmIChpblNjcm9sbCkgcmV0dXJuXHJcbiAgICBjb25zdCB0cmFuc2l0aW9uT3ZlciA9IDEwMDA7XHJcbiAgICBjb25zdCBtb3VzZUluZXJ0aWFPdmVyID0gMzAwO1xyXG5cclxuICAgIGluU2Nyb2xsID0gdHJ1ZTtcclxuXHJcbiAgICBjb25zdCBwb3NpdGlvbiA9IGNvdW5TZWN0aW9uUG9zaXRpb24oc2VjdGlvbkVxKTtcclxuXHJcbiAgICBkaXNwbGF5LmNzcyh7XHJcbiAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSUpYCxcclxuICAgIH0pO1xyXG5cclxuICAgIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKHNlY3Rpb25zLCBzZWN0aW9uRXEsICdhY3RpdmUnKTtcclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+e1xyXG4gICAgICAgIGluU2Nyb2xsPSBmYWxzZTtcclxuXHJcbiAgICAgICAgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0obWVudUl0ZW1zLCBzZWN0aW9uRXEsICdmaXhlZC1tZW51X19pdGVtLS1hY3RpdmUnKTsgXHJcbiAgICB9LCB0cmFuc2l0aW9uT3ZlciArIG1vdXNlSW5lcnRpYU92ZXIpO1xyXG4gICAgXHJcbn07XHJcblxyXG5jb25zdCB2aWVwb3J0U2Nyb2xsZXIgPSAoKSA9PiB7XHJcbmNvbnN0IGFjdGl2ZVNlY3Rpb24gPSBzZWN0aW9ucy5maWx0ZXIoXCIuYWN0aXZlXCIpO1xyXG5jb25zdCBuZXh0U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ubmV4dCgpO1xyXG5jb25zdCBwcmV2U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ucHJldigpO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbmV4dCAoKXtcclxuICAgICAgICAgICAgaWYgKG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcGVyZm9ybVRyYW5zaXRpb24obmV4dFNlY3Rpb24uaW5kZXgoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBwcmV2KCl7XHJcbiAgICAgICAgICAgIGlmIChwcmV2U2VjdGlvbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSAgICBcclxufVxyXG5cclxuJCh3aW5kb3cpLm9uKCd3aGVlbCcsIGUgPT57XHJcbiAgICBjb25zdCBkZWx0YVkgPSBlLm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xyXG4gICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWVwb3J0U2Nyb2xsZXIoKTtcclxuXHJcbiAgICBpZiAoZGVsdGFZID4gMCl7XHJcbiAgICAgICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4gICAgICAgIC8vIHNjcm9sbFZpZXBvcnQoJ25leHQnKTtcclxuICAgIH1cclxuICAgIGlmIChkZWx0YVkgPCAwKXtcclxuICAgICAgICBzY3JvbGxlci5wcmV2KCk7XHJcbiAgICAgICAgLy8gc2Nyb2xsVmllcG9ydCgncHJldicpO1xyXG4gICAgfVxyXG4gICAgY29uc29sZS5sb2coZGVsdGFZKTtcclxufSk7XHJcblxyXG4kKHdpbmRvdykub24oXCJrZXlkb3duXCIsIChlKT0+e1xyXG4gICAgY29uc3QgdGFnTmFtZSA9IGUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgIGNvbnN0IHVzZXJUeXBpbmdJbnB1dHMgPSB0YWdOYW1lID09IFwiaW5wdXRcIiB8fCB0YWdOYW1lID09IFwidGV4dGFyZWFcIjtcclxuICAgIGNvbnN0IHNjcm9sbGVyID0gdmllcG9ydFNjcm9sbGVyKCk7XHJcbiAgICBcclxuICAgIGlmICh1c2VyVHlwaW5nSW5wdXRzKSByZXR1cm47XHJcbiAgICBcclxuICAgIHN3aXRjaChlLmtleUNvZGUpe1xyXG4gICAgICAgIGNhc2UgMzg6XHJcbiAgICAgICAgICAgIHNjcm9sbGVyLnByZXYoKTs7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgNDA6XHJcbiAgICAgICAgICAgIHNjcm9sbGVyLm5leHQoKTs7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfTtcclxufSk7XHJcblxyXG4kKFwiW2RhdGEtc2Nyb2xsLXRvXVwiKS5jbGljayhlID0+e1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cignZGF0YS1zY3JvbGwtdG8nKTtcclxuICAgIGNvbnN0IHJlcVNlY3Rpb24gPSAkKGBbZGF0YS1zZWN0aW9uLWlkPSR7W3RhcmdldF19XWApO1xyXG5cclxuICAgIHBlcmZvcm1UcmFuc2l0aW9uKHJlcVNlY3Rpb24uaW5kZXgoKSk7XHJcbn0pO1xyXG5cclxuaWYgKGlzTW9iaWxlKXtcclxuICAgIC8vaHR0cHM6Ly9naXRodWIuY29tL21hdHRicnlzb24vVG91Y2hTd2lwZS1KcXVlcnktUGx1Z2luXHJcbiAgICAkKFwiYm9keVwiKS5zd2lwZSAoe1xyXG4gICAgICAgIHN3aXBlOiBmdW5jdGlvbihldmVudCwgZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjcm9sbGVyID0gdmllcG9ydFNjcm9sbGVyKCk7XHJcbiAgICAgICAgICAgIGxldCBzY3JvbGxEaXJlY3Rpb24gPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJ1cFwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcIm5leHRcIjtcclxuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJkb3duXCIpIHNjcm9sbERpcmVjdGlvbiA9IFwicHJldlwiO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHNjcm9sbERpcmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgc2Nyb2xsZXJbc2Nyb2xsRGlyZWN0aW9uXSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7ICAgXHJcbn1cclxuXHJcbiIsIjsoZnVuY3Rpb24oKXtcclxuLy8g0LHQvtC70YzRiNCw0Y8g0LrQvdC+0L/QutCwINCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjRj1xyXG5jb25zdCBwbGF5QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi52aWRlb19fcGxheWVyLWltZ1wiKTtcclxuLy8g0LzQsNC70LXQvdGM0LrQsNGPINC60L3QvtC/0LrQsCDQstC+0YHRgNC+0LjQt9Cy0LXQtNC10L3QuNGPXHJcbmNvbnN0IHBsYXllclBsYXlCcm4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmR1cmF0aW9uX19pbWdcIik7XHJcbi8vINGB0LDQvNC+INCy0LjQtNC10L5cclxuY29uc3QgdmlkZW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsYXllclwiKTtcclxuLy8gaW5wdXQg0YEg0L/QvtC80L7RidGM0Y4g0LrQvtGC0L7RgNC+0LPQviDQstGL0YHRgtCw0LLQu9GP0LXRgtGB0Y8g0LLRgNC10LzRjyDQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40Y9cclxuY29uc3QgZHVyYXRpb25Db250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkdXJhdGlvbkxldmVsXCIpO1xyXG4vLyBpbnB1dCDRgSDQv9C+0LzQvtGJ0YzRjiDQutC+0YLQvtGA0L7Qs9C+INCy0YvRgdGC0LDQstC70Y/QtdGC0YHRjyDQs9GA0L7QvNC60L7RgdGC0YxcclxuY29uc3Qgc291bmRDb250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaWNMZXZlbFwiKTtcclxuLy8g0L7QsdGR0YDRgtC60LAg0YPQv9GA0LDQstC70LXQvdC40Y8g0LPRgNC+0LzQutC+0YHRgtGM0Y5cclxuY29uc3Qgc291bmRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNvdW5kQnRuXCIpO1xyXG4vLyDQutC90L7Qv9C60LAg0YEg0LTQuNC90LDQvNC40LrQvtC8LCDRgSDQv9C+0LzQvtGJ0YzRjiDQutC+0YLQvtGA0L7QuSDQvNGLINCx0YPQtNC10Lwg0LLQutC70Y7Rh9C40YLRjCDQuNC70Lgg0LLRi9C60LvRjtGH0LDRgtGMINCz0YDQvtC80LrQvtGB0YLRjCBcclxuY29uc3QgZHluYW1pY0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkeW5hbWljJyk7XHJcbi8vINC40LTQtdC90YLQuNGE0LjQutCw0YLQvtGAINC40L3RgtC10YDQstCw0LvQsCwg0LrQvtGC0L7RgNGL0Lkg0LHRg9C00LXRgiDQvtGC0YDQuNGB0L7QstGL0LLQsNGC0Ywg0YLQtdC60YPRidC10LUg0LLRgNC10LzRjyDQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40Y9cclxubGV0IGludGVydmFsSWQ7XHJcbi8vINC/0LXRgNC10LzQtdC90L3QsNGPINC00LvRjyDRgdC+0YXRgNCw0L3QtdC90LjRjyDRg9GA0L7QstC90Y8g0LPRgNC+0LzQutC+0YHRgtC4INC/0LXRgNC10LQg0LLRi9C60LvRjtGH0LXQvdC40LXQvCDQt9Cy0YPQutCwXHJcbmxldCBzb3VuZExldmVsO1xyXG5cclxuLy8g0L7RgtGB0LvQtdC20LjQstCw0LXQvCDQt9Cw0LPRgNGD0LfQutGDINC80LXQtNC40YTQsNC50LvQvtCyINGB0YLRgNCw0L3QuNGG0Ytcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbigpIHtcclxuICAvLyDQv9GA0Lgg0LrQu9C40LrQtSDQvdCwINGB0LDQvNC+INCy0LjQtNC10L4g0LLRi9C/0L7Qu9C90Y/QtdC8INGE0YPQvdC60YbQuNGOIHBsYXlTdG9wXHJcbiAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHBsYXlTdG9wKTtcclxuICAgLy8g0L3QsNGF0L7QtNC40Lwg0LLRgdC1INC60L3QvtC/0LrQuCDRg9C/0YDQsNCy0LvQtdC90LjRjyBwbGF5L3BhdXNlXHJcbiAgbGV0IHBsYXlCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wbGF5XCIpO1xyXG4gIFxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcGxheUJ1dHRvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgIC8vINC/0YDQuCDQutC70LjQutC1INC90LAg0Y3RgtC4INC60L3QvtC/0LrQuCDQstGL0L/QvtC70L3Rj9C10Lwg0YTRg9C90LrRhtC40Y4gcGxheVN0b3BcclxuICAgIHBsYXlCdXR0b25zW2ldLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwbGF5U3RvcCk7XHJcbiAgfVxyXG5cclxuICAvLyDQstGL0YHRgtCw0LLQu9GP0LXQvCDQvNC40L3QuNC80LDQu9GM0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0L/QvtC70LfRg9C90LrQsCDQstGA0LXQvNC10L3QuCDQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40Y9cclxuICBkdXJhdGlvbkNvbnRyb2wubWluID0gMDtcclxuICAvLyDQstGL0YHRgtCw0LLQu9GP0LXQvCDQstGA0LXQvNGPINCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjRjyDQsiDQvdC+0LvRjFxyXG4gIGR1cmF0aW9uQ29udHJvbC52YWx1ZSA9IDA7XHJcbiAgLy8g0LLRi9GB0YLQsNCy0LvRj9C10Lwg0LzQsNC60YHQuNC80LDQu9GM0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0L/QvtC70LfRg9C90LrQsCDQstGA0LXQvNC10L3QuCDQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40Y8g0L/QviDQtNC70LjRgtC10LvRjNC90L7RgdGC0Lgg0LLQuNC00LXQvlxyXG4gIGR1cmF0aW9uQ29udHJvbC5tYXggPSB2aWRlby5kdXJhdGlvbjtcclxuICAvLyDQv9GA0Lgg0LrQu9C40LrQsNGFINC40LvQuCDQv9C10YDQtdGC0Y/Qs9C40LLQsNC90LjQuCDQv9C+0LvQt9GD0L3QutCwINCy0YvQv9C+0LvQvdGP0LXQvCDRhNGD0L3QutGG0LjRjiBzZXRWaWRlb0R1cmF0aW9uXHJcbiAgZHVyYXRpb25Db250cm9sLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBzZXRWaWRlb0R1cmF0aW9uKTtcclxuXHJcbiAgLy8g0LLRi9GB0YLQsNCy0LvRj9C10Lwg0LzQuNC90LjQvNCw0LvRjNC90L7QtSDQt9C90LDRh9C10L3QuNC1INC/0L7Qu9C30YPQvdC60LAg0LPRgNC+0LzQutC+0YHRgtC4XHJcbiAgc291bmRDb250cm9sLm1pbiA9IDA7XHJcbiAgLy8g0LLRi9GB0YLQsNCy0LvRj9C10Lwg0LzQsNC60YHQuNC80LDQu9GM0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0L/QvtC70LfRg9C90LrQsCDQs9GA0L7QvNC60L7RgdGC0LhcclxuICBzb3VuZENvbnRyb2wubWF4ID0gMTA7XHJcbiAgLy8g0LLRi9GB0YLQsNCy0LvRj9C10Lwg0YLQtdC60YPRidC10LUg0L/QvtC70L7QttC10L3QuNC1INC/0L7Qu9C30YPQvdC60LAg0LPRgNC+0LzQutC+0YHRgtC4INC90LAg0LzQsNC60YHQuNC80YPQvFxyXG4gIHNvdW5kQ29udHJvbC52YWx1ZSA9IHNvdW5kQ29udHJvbC5taW47XHJcbiAgLy8g0L/RgNC4INC60LvQuNC60LDRhSDQuNC70Lgg0L/QtdGA0LXRgtGP0LPQuNCy0LDQvdC40Lgg0L/QvtC70LfRg9C90LrQsCDQstGL0L/QvtC70L3Rj9C10Lwg0YTRg9C90LrRhtC40Y4gY2hhbmdlU291bmRWb2x1bWVcclxuICBzb3VuZENvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGNoYW5nZVNvdW5kVm9sdW1lKTtcclxuXHJcbiAgLy8g0L/RgNC4INC60LvQuNC60LUg0L3QsCDQtNC40L3QsNC80LjQuiDQstGL0L/QvtC70L3Rj9C10Lwgc291bmRPZlxyXG4gIGR5bmFtaWNCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzb3VuZE9mKTtcclxuXHJcbiAgLy8g0LrQvtCz0LTQsCDQstC40LTQtdC+INC30LDQutC+0L3Rh9C40YLRgdGPXHJcbiAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignZW5kZWQnLCAoKSA9PiB7XHJcbiAgICAgIC8vINCy0YvRgdGC0LDQstC70Y/QtdC8INC60LvQsNGB0YHRiyDQvdCwINC60L3QvtC/0LrQuCwg0YfRgtC+0LEg0L7RgtC+0LHRgNCw0LfQuNGC0YwsINGH0YLQviDQvNC+0LbQvdC+INCy0L7RgdC/0YDQvtC40LfQstC+0LTQuNGC0Ywg0YHQvdC+0LLQsFxyXG4gICAgICBwbGF5QnRuLmNsYXNzTGlzdC50b2dnbGUoJ3ZpZGVvX19wbGF5ZXItaW1nLS1hY3RpdmUnKTtcclxuICAgICAgcGxheWVyUGxheUJybi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgICAgLy8g0YPRgdGC0LDQvdCw0LLQu9C40LLQsNC10Lwg0LLRgNC10LzRjyDQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40Y8g0LIg0L3QvtC70YxcclxuICAgICAgdmlkZW8uY3VycmVudFRpbWUgPSAwO1xyXG4gIH0pXHJcbn0pO1xyXG5cclxuLy8g0YTRg9C90LrRhtC40Y8g0LLQvtGB0L/RgNC+0LjQt9Cy0L7QtNC40YLRjC/Qv9C+0YHRgtCw0LLQuNGC0Ywg0L3QsCDQv9Cw0YPQt9GDXHJcbmZ1bmN0aW9uIHBsYXlTdG9wKCkge1xyXG4gIC8vINGD0YHRgtCw0L3QsNCy0LvQuNCy0LDQtdC8INCw0LrRgtC40LLQvdGL0LUg0LrQu9Cw0YHRgdGLINC90LAg0Y3Qu9C10LzQtdC90YLRiyDRh9GC0L7QsSDQv9C+0LrQsNC30LDRgtGMINCy0L7RgdC/0YDQvtC40LfQstC+0LTQuNGC0YHRjyDRgdC10LnRh9Cw0YEg0LLQuNC00LXQviDQuNC70Lgg0L3QtdGCXHJcbiAgcGxheUJ0bi5jbGFzc0xpc3QudG9nZ2xlKFwidmlkZW9fX3BsYXllci1pbWctLWFjdGl2ZVwiKTtcclxuICBwbGF5ZXJQbGF5QnJuLmNsYXNzTGlzdC50b2dnbGUoXCJhY3RpdmVcIik7XHJcblxyXG4gIC8vINC10YHQu9C4INCy0LjQtNC10L4g0L3QsCDQv9Cw0YPQt9C1XHJcbiAgaWYgKHZpZGVvLnBhdXNlZCkge1xyXG4gICAgLy8g0LfQsNC/0YPRgdC60LDQtdC8INC10LPQvlxyXG4gICAgdmlkZW8ucGxheSgpO1xyXG4gICAgLy8g0LfQsNC/0YPRgdC60LDQtdC8INC+0YLRgNC40YHQvtCy0LrRgyDQv9C+0LvQt9GD0L3QutCwINCy0YDQtdC80LXQvdC4INCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjRj1xyXG4gICAgaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKHVwZGF0ZUR1cmF0aW9uLCAxMDAwIC8gNjApO1xyXG4gIC8vINC10YHQu9C4INCy0LjQtNC10L4g0L3QtSDQvdCwINC/0LDRg9C30LVcclxuICB9IGVsc2Uge1xyXG4gICAgLy8g0L7RgdGC0LDQvdCw0LLQu9C40LLQsNC10Lwg0L7RgtGA0LjRgdC+0LLQutGDINC/0L7Qu9C30YPQvdC60LAg0LLRgNC10LzQtdC90Lgg0LLQvtGB0L/RgNC+0LjQt9Cy0LXQtNC10L3QuNGPXHJcbiAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xyXG4gICAgLy8g0YHRgtCw0LLQuNC8INCy0LjQtNC10L4g0L3QsCDQv9Cw0YPQt9GDXHJcbiAgICB2aWRlby5wYXVzZSgpO1xyXG4gIH1cclxufVxyXG5cclxuLy8g0YTRg9C90LrRhtC40Y8g0YPRgdGC0LDQvdC+0LLQuNGC0Ywg0YLQtdC60YPRidC10LUg0LLRgNC10LzRjyDQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40Y9cclxuZnVuY3Rpb24gc2V0VmlkZW9EdXJhdGlvbigpIHtcclxuICAvLyDRg9GB0YLQsNC90L7QstC70LjQstCw0LXRgiDRgtC10LrRg9GJ0LXQtSDQstGA0LXQvNGPINCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjRjyDQstC40LTQtdC+INC/0L4g0L/QvtC30LjRhtC40Lgg0L/QvtC70LfRg9C90LrQsFxyXG4gIHZpZGVvLmN1cnJlbnRUaW1lID0gZHVyYXRpb25Db250cm9sLnZhbHVlO1xyXG4gIC8vINC+0YLRgNC40YHQvtCy0YvQstCw0LXRgiDQv9C+0LvQvtGB0YMg0L/RgNC+0LPRgNC10YHRgdCwXHJcbiAgdXBkYXRlRHVyYXRpb24oKTtcclxufVxyXG5cclxuLypcclxuICDQpNGD0L3QutGG0LjRjyDQtNC70Y8g0L7QsdC90L7QstC70LXQvdC40Y8g0L/QvtC30LjRhtC40Lgg0L/QvtC70LfRg9C90LrQsCDQv9GA0L7QtNC+0LvQttC40YLQtdC70YzQvdC+0YHRgtC4INCy0LjQtNC10L4uICAgXHJcbiovXHJcbmZ1bmN0aW9uIHVwZGF0ZUR1cmF0aW9uKCkge1xyXG4gIC8vINGD0YHRgtCw0L3QsNCy0LvQuNCy0LDQtdC8INCyINC90LDRiCDQuNC90L/Rg9GCINGC0LXQutGD0YnQtdC1INCy0YDQtdC80Y9cclxuICBkdXJhdGlvbkNvbnRyb2wudmFsdWUgPSB2aWRlby5jdXJyZW50VGltZTtcclxuICAvLyDRgNCw0YHRgdGH0LjRgtGL0LLQsNC10Lwg0L/RgNC+0YbQtdC90YIg0LTQu9GPINC30LDQutGA0LDRgdC60Lgg0L/RgNC+0LPRgNC10YHRgdCwXHJcbiAgbGV0IHN0ZXAgPSB2aWRlby5kdXJhdGlvbiAvIDEwMDsgLy8gMTIxIC8gMTAwID0gMS4yMVxyXG4gIGxldCBwZXJjZW50ID0gdmlkZW8uY3VycmVudFRpbWUgLyBzdGVwOyAvLyA2MCAvIDEuMjFcclxuICAvLyDRg9GB0YLQsNC90LDQstC70LjQstCw0LXQvCDRgdGC0LjQu9C4XHJcbiAgZHVyYXRpb25Db250cm9sLnN0eWxlLmJhY2tncm91bmQgPSBgbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjRkVEQjNGIDAlLCAjRkVEQjNGICR7cGVyY2VudH0lLCAjNjI2MjYyICR7cGVyY2VudH0lKWA7XHJcbn1cclxuXHJcbi8vINGE0YPQvdC60YbQuNGPINC40LfQvNC10L3QtdC90LjRjyDRg9GA0L7QstC90Y8g0LPRgNC+0LzQutC+0YHRgtC4XHJcbmZ1bmN0aW9uIGNoYW5nZVNvdW5kVm9sdW1lKCkge1xyXG4gIC8vINCy0LjQtNC10L4g0L/RgNC40L3QuNC80LDQtdGCINGC0L7Qu9GM0LrQviDQt9C90LDRh9C10L3QuNGPINC+0YIgMCDQtNC+IDEsINGC0L4g0LXRgdGC0Ywg0LTRgNC+0LHQvdGL0LUg0YfQuNGB0LvQsFxyXG4gIC8vINC/0L7RjdGC0L7QvNGDINGC0LXQutGD0YnQtdC1INC30L3QsNGH0LXQvdC40LUg0L/QvtC70LfRg9C90LrQsCDQs9GA0L7QvNC60L7RgdGC0Lgg0LTQtdC70LjQvCDQvdCwIDEwXHJcbiAgdmlkZW8udm9sdW1lID0gc291bmRDb250cm9sLnZhbHVlIC8gMTA7IC8vIDAuMSAwLjguLi5cclxuICAvLyDQtdGB0LvQuCDQvNGLINCy0YvRgdGC0LDQstC40LvQuCDQv9C+0LvQt9GD0L3QvtC6INCyINC90L7Qu9GMXHJcbiAgaWYgKHZpZGVvLnZvbHVtZSA9PT0gMCkge1xyXG4gICAgLy8g0YLQviDQvtGC0L7QsdGA0LDQttCw0LXQvCDQvdCwINC00LjQvdCw0LzQuNC60LUg0YfRgtC+INC30LLRg9C6INCy0YvQutC70Y7Rh9C10L1cclxuICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XHJcbiAgLy8g0LXRgdC70Lgg0LfQstGD0Log0L3QtSDQstGL0LrQu9GO0YfQtdC9LCDRgtC+INGB0L3QuNC80LDQtdC8INC+0YLQvtCx0YDQsNC20LXQvdC40LUg0LLRi9C60LvRjtGH0LXQvdC90L7Qs9C+INC30LLRg9C60LAg0YEg0LjQutC90L7QutC4INC00LjQvdCw0LzQuNC60LBcclxuICB9IGVsc2Uge1xyXG4gICAgc291bmRCdG4uY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcclxuICB9XHJcbn1cclxuXHJcbi8vINGE0YPQvdC60YbQuNGPINCy0LrQu9GO0YfQtdC90LjRjy/QstGL0LrQu9GO0YfQtdC90LjRjyDQt9Cy0YPQutCwXHJcbmZ1bmN0aW9uIHNvdW5kT2YoKSB7XHJcbiAgLy8g0LXRgdC70Lgg0L/RgNC4INC30LDQv9GD0YHQutC1INGE0YPQvdC60YbQuNC4INC30LLRg9C6INCy0YvQutC70Y7Rh9C10L1cclxuICBpZiAodmlkZW8udm9sdW1lID09PSAwKSB7XHJcbiAgICAgIC8vINC80Ysg0LHQtdGA0LXQvCDQv9GA0LXQtNGL0LTRg9GJ0LXQtSDRgdC+0YXRgNCw0L3QtdC90L3QvtC1INC30L3QsNGH0LXQvdC40LUg0LPRgNC+0LzQutC+0YHRgtC4INC4INCy0YvRgdGC0LDQstC70Y/QtdC8INCyINCy0LjQtNC10L5cclxuICAgICAgdmlkZW8udm9sdW1lID0gc291bmRMZXZlbDtcclxuICAgICAgLy8g0L7RgtGA0LjRgdC+0LLRi9Cy0LDQtdC8INGN0YLQviDQsiDQv9C+0LvQt9GD0L3QvtC6INCz0YDQvtC80LrQvtGB0YLQuFxyXG4gICAgICBzb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZExldmVsICogMTA7XHJcbiAgICAgIC8vINGD0LHQuNGA0LDQtdC8INC+0YLQvtCx0YDQsNC20LXQvdC40LUg0LLRi9C60LvRjtGH0LXQvdC90L7Qs9C+INC30LLRg9C60LAg0YEg0LjQutC+0L3QutC4INC00LjQvdCw0LzQuNC60LBcclxuICAgICAgc291bmRCdG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgLy8g0LXRgdC70Lgg0L/RgNC4INC30LDQv9GD0YHQutC1INGE0YPQvdC60YbQuNC4INC30LLRg9C6INCy0LrQu9GO0YfQtdC9XHJcbiAgfSBlbHNlIHtcclxuICAgIC8vINGB0L7RhdGA0LDQvdGP0LXQvCDRgtC10LrRg9GJ0LXQtSDQt9C90LDRh9C10L3QuNC1INCz0YDQvtC80LrQvtGB0YLQuFxyXG4gICAgc291bmRMZXZlbCA9IHZpZGVvLnZvbHVtZTtcclxuICAgIC8vINCy0YvRgdGC0LDQstC70Y/QtdC8INCz0YDQvtC80LrQvtGB0YLRjCDQsiDQvdC+0LvRjFxyXG4gICAgdmlkZW8udm9sdW1lID0gMDtcclxuICAgIC8vINC+0YLRgNC40YHQvtCy0YvQstCw0LXQvCDRjdGC0L4g0L3QsCDQv9C+0LvQt9GD0L3QutC1INCz0YDQvtC80LrQvtGB0YLQuFxyXG4gICAgc291bmRDb250cm9sLnZhbHVlID0gMDtcclxuICAgIC8vINC+0YLQvtCx0YDQsNC20LDQtdC8INC90LAg0LjQutC+0L3QutC1INC00LjQvdCw0LzQuNC60LAsINGH0YLQviDQt9Cy0YPQuiDQstGL0LrQu9GO0YfQtdC9XHJcbiAgICBzb3VuZEJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICB9XHJcbn1cclxufSkoKSIsIjsoZnVuY3Rpb24oKXtcclxuICAgIGNvbnN0IGl0ZW1SZWNhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmV2aWV3c19faXRlbScpO1xyXG4gICAgY29uc3QgaXRlbVVzZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmV2aWV3cy11c2Vyc19faXRlbScpO1xyXG4gICAgXHJcbiAgICBpdGVtVXNlci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50QnRuID0gaXRlbTtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRJZCA9IGN1cnJlbnRCdG4uZ2V0QXR0cmlidXRlKFwiZGF0YS1vcGVuXCIpO1xyXG4gICAgICAgICAgICBsZXQgY3VycmVudFRhYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY3VycmVudElkKTtcclxuICAgIFxyXG4gICAgICAgICAgICBpZighY3VycmVudEJ0bi5jbGFzc0xpc3QuY29udGFpbnMoJ2ludGVyYWN0aXZlX19hdmF0YXItLWFjdGl2ZScpKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtVXNlci5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnaW50ZXJhY3RpdmVfX2F2YXRhci0tYWN0aXZlJylcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaXRlbVJlY2FsbC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgncmV2aWV3c19faXRlbS0tc2hvd2luZycpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBjdXJyZW50QnRuLmNsYXNzTGlzdC5hZGQoJ2ludGVyYWN0aXZlX19hdmF0YXItLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudFRhYi5jbGFzc0xpc3QuYWRkKCdyZXZpZXdzX19pdGVtLS1zaG93aW5nJyk7XHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSkoKSIsIjsoZnVuY3Rpb24oKXtcclxuICAgIGNvbnN0IHNsaWRlclNob3AgPSAkKCcuc2hvcF9fbGlzdCcpLmJ4U2xpZGVyKHtcclxuICAgICAgICBwYWdlcjogZmFsc2UsXHJcbiAgICAgICAgY29udHJvbHM6IGZhbHNlXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgJCgnLnNsaWRlcl9fc2hvcC1sZWZ0JykuY2xpY2soKGUpID0+e1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIFxyXG4gICAgICAgIHNsaWRlclNob3AuZ29Ub1ByZXZTbGlkZSgpO1xyXG4gICAgfSlcclxuICAgICQoJy5zbGlkZXJfX3Nob3AtcmlnaHQnKS5jbGljaygoZSk9PntcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBcclxuICAgICAgICBzbGlkZXJTaG9wLmdvVG9OZXh0U2xpZGUoKTtcclxuICAgIH0pXHJcbn0pKCkiLCI7KGZ1bmN0aW9uKCl7XHJcbiAgICBjb25zdCB0ZWFtTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50ZWFtX19uYW1lJyk7XHJcbiAgICBjb25zdCB0ZWFtRGVzYyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50ZWFtX19kZXNjJyk7XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGNsb3NlRXZlcnlJdGVtcygpe1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGVhbU5hbWUubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gdGVhbU5hbWVbaV07XHJcbiAgICBcclxuICAgICAgICAgICAgY29uc3QgZGVzYyA9IGJ1dHRvbi5uZXh0RWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgICAgIGRlc2MuY2xhc3NMaXN0LnJlbW92ZSgndGVhbV9fZGVzYy0tYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCd0ZWFtX19uYW1lLS1hY3RpdmUnKTsgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRlYW1OYW1lLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgIGNvbnN0IGJ1dHRvbiA9IHRlYW1OYW1lW2luZGV4XTtcclxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkgeyAgIFxyXG4gICAgXHJcbiAgICAgICAgICAgIGlmICh0ZWFtTmFtZVtpbmRleF0uY2xhc3NMaXN0LmNvbnRhaW5zKCd0ZWFtX19uYW1lLS1hY3RpdmUnKSAmJiB0ZWFtRGVzY1tpbmRleF0uY2xhc3NMaXN0LmNvbnRhaW5zKCd0ZWFtX19kZXNjLS1hY3RpdmUnKSkge1xyXG4gICAgICAgICAgICAgICAgY2xvc2VFdmVyeUl0ZW1zKClcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNsb3NlRXZlcnlJdGVtcygpXHJcbiAgICAgICAgICAgICAgICB0ZWFtRGVzY1tpbmRleF0uY2xhc3NMaXN0LmFkZCgndGVhbV9fZGVzYy0tYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICB0ZWFtTmFtZVtpbmRleF0uY2xhc3NMaXN0LmFkZCgndGVhbV9fbmFtZS0tYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSkoKVxyXG4iXX0=
